<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques & Analytics - Travel Admin</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <i class="fas fa-plane-departure"></i>
            <span>Travel Admin</span>
        </div>
        
        <nav class="nav-menu">
            <a href="index.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="reservations.html" class="nav-item">
                <i class="fas fa-ticket-alt"></i>
                <span>R√©servations</span>
            </a>
            <a href="clients.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span>Clients</span>
            </a>
            <a href="vol.html" class="nav-item">
                <i class="fas fa-plane"></i>
                <span>Vols</span>
            </a>
            <a href="paiements.html" class="nav-item">
                <i class="fas fa-money-bill-wave"></i>
                <span>Paiements</span>
            </a>
            <a href="statistiques.html" class="nav-item active">
                <i class="fas fa-chart-bar"></i>
                <span>Statistiques</span>
            </a>
            <a href="parametres.html" class="nav-item">
                <i class="fas fa-cog"></i>
                <span>Param√®tres</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="#" class="nav-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>D√©connexion</span>
            </a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Statistiques & Analytics</h1>
            </div>
            
            <div class="topbar-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher...">
                </div>
                
                <div class="notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge">12</span>
                </div>
                
                <div class="user-profile">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=667eea&color=fff" alt="User">
                    <div class="user-info">
                        <span class="user-name">Admin User</span>
                        <span class="user-role">Data Analyst</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Filtres Avanc√©s -->
            <div class="stats-filters mb-4">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label fw-bold"><i class="fas fa-calendar-alt me-2"></i>P√©riode</label>
                        <select class="form-select" id="filterPeriod" onchange="updateStatistics()">
                            <option value="7days">7 derniers jours</option>
                            <option value="30days" selected>30 derniers jours</option>
                            <option value="90days">90 derniers jours</option>
                            <option value="1year">1 an</option>
                            <option value="custom">Personnalis√©</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold"><i class="fas fa-balance-scale me-2"></i>Comparer avec</label>
                        <select class="form-select" id="filterCompare" onchange="updateStatistics()">
                            <option value="previous">P√©riode pr√©c√©dente</option>
                            <option value="year">Ann√©e N-1</option>
                            <option value="budget">Budget pr√©visionnel</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold"><i class="fas fa-filter me-2"></i>Segmentation</label>
                        <select class="form-select" id="filterSegment" onchange="updateStatistics()">
                            <option value="all">Tous</option>
                            <option value="destination">Par Destination</option>
                            <option value="company">Par Compagnie</option>
                            <option value="class">Par Classe</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold"><i class="fas fa-chart-line me-2"></i>Granularit√©</label>
                        <select class="form-select" id="filterGranularity" onchange="updateStatistics()">
                            <option value="hour">Par Heure</option>
                            <option value="day" selected>Par Jour</option>
                            <option value="week">Par Semaine</option>
                            <option value="month">Par Mois</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons mb-4">
                <button class="btn btn-primary" onclick="openPredictionModal()">
                    <i class="fas fa-crystal-ball me-2"></i>Voir Pr√©dictions IA
                </button>
                <button class="btn btn-success" onclick="exportReport()">
                    <i class="fas fa-file-download me-2"></i>Exporter Rapport
                </button>
                <button class="btn btn-info" onclick="openInsightsModal()">
                    <i class="fas fa-lightbulb me-2"></i>Insights Automatiques
                </button>
                <button class="btn btn-warning" onclick="openRecommendationsModal()">
                    <i class="fas fa-magic me-2"></i>Recommandations
                </button>
            </div>
            
            <!-- KPI Cards Avanc√©s -->
            <div class="kpi-container-extended">
                <div class="kpi-card blue clickable" onclick="showKPIDetails('revenue')">
                    <div class="kpi-icon">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-title">Revenu Total</div>
                        <div class="kpi-value">2.8M‚Ç¨</div>
                        <div class="kpi-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+12.5% vs p√©riode pr√©c√©dente</span>
                        </div>
                    </div>
                </div>
                
                <div class="kpi-card green clickable" onclick="showKPIDetails('conversion')">
                    <div class="kpi-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-title">Taux de Conversion</div>
                        <div class="kpi-value">88.2%</div>
                        <div class="kpi-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+3.2% vs p√©riode pr√©c√©dente</span>
                        </div>
                    </div>
                </div>
                
                <div class="kpi-card orange clickable" onclick="showKPIDetails('avg')">
                    <div class="kpi-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-title">Valeur Moyenne</div>
                        <div class="kpi-value">847‚Ç¨</div>
                        <div class="kpi-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+5.8% vs p√©riode pr√©c√©dente</span>
                        </div>
                    </div>
                </div>
                
                <div class="kpi-card purple clickable" onclick="showKPIDetails('roi')">
                    <div class="kpi-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-title">ROI Marketing</div>
                        <div class="kpi-value">342%</div>
                        <div class="kpi-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+18% vs p√©riode pr√©c√©dente</span>
                        </div>
                    </div>
                </div>
                
                <div class="kpi-card purple clickable" onclick="showKPIDetails('satisfaction')">
                    <div class="kpi-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-title">Satisfaction Client</div>
                        <div class="kpi-value">4.7/5</div>
                        <div class="kpi-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+0.3 vs p√©riode pr√©c√©dente</span>
                        </div>
                    </div>
                </div>
                
                <div class="kpi-card purple clickable" onclick="showKPIDetails('growth')">
                    <div class="kpi-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-title">Croissance Annuelle</div>
                        <div class="kpi-value">+24.5%</div>
                        <div class="kpi-trend up">
                            <i class="fas fa-arrow-up"></i>
                            <span>vs 2023</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Graphique 1 - Pr√©dictions de Revenus -->
            <div class="charts-row">
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <h3><i class="fas fa-crystal-ball me-2"></i>Pr√©visions de Revenus - 12 Prochains Mois</h3>
                        <button class="btn btn-sm btn-outline-primary" onclick="showChartInfo('prediction')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="predictionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Row avec 2 graphiques -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-filter me-2"></i>Entonnoir de Conversion</h3>
                            <button class="btn btn-sm btn-outline-primary" onclick="showChartInfo('funnel')">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="funnelChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar me-2"></i>Comparaison Multi-Ann√©es</h3>
                            <button class="btn btn-sm btn-outline-primary" onclick="showChartInfo('comparison')">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Heatmap Performance -->
            <div class="charts-row">
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <h3><i class="fas fa-fire me-2"></i>Performance par Jour/Heure (Heatmap)</h3>
                        <button class="btn btn-sm btn-outline-primary" onclick="showChartInfo('heatmap')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                    <div class="heatmap-container">
                        <div id="heatmapGrid"></div>
                    </div>
                </div>
            </div>
            
            <!-- Row avec 2 graphiques -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-globe me-2"></i>Distribution G√©ographique</h3>
                            <button class="btn btn-sm btn-outline-primary" onclick="showChartInfo('geo')">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="geoChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-sort-amount-down me-2"></i>Analyse ABC (Pareto)</h3>
                            <button class="btn btn-sm btn-outline-primary" onclick="showChartInfo('pareto')">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="paretoChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tableaux Analytiques -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="analytics-table-card">
                        <div class="table-header">
                            <h3><i class="fas fa-table me-2"></i>Performance par Destination</h3>
                            <button class="btn btn-sm btn-success" onclick="exportTable('destinations')">
                                <i class="fas fa-file-excel me-2"></i>Exporter
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table modern-table">
                                <thead>
                                    <tr>
                                        <th>Destination</th>
                                        <th>R√©servations</th>
                                        <th>Revenu</th>
                                        <th>Marge</th>
                                        <th>Taux Conversion</th>
                                        <th>Satisfaction</th>
                                        <th>Tendance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>New York</strong></td>
                                        <td>245</td>
                                        <td class="text-success fw-bold">458,750‚Ç¨</td>
                                        <td>32%</td>
                                        <td>89.2%</td>
                                        <td><span class="badge bg-success">4.8/5</span></td>
                                        <td><span class="trend-badge up">+15%</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="showDestinationDetails('New York')">
                                                <i class="fas fa-chart-line"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Duba√Ø</strong></td>
                                        <td>198</td>
                                        <td class="text-success fw-bold">387,450‚Ç¨</td>
                                        <td>28%</td>
                                        <td>85.4%</td>
                                        <td><span class="badge bg-success">4.7/5</span></td>
                                        <td><span class="trend-badge up">+12%</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="showDestinationDetails('Duba√Ø')">
                                                <i class="fas fa-chart-line"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Tokyo</strong></td>
                                        <td>187</td>
                                        <td class="text-success fw-bold">342,890‚Ç¨</td>
                                        <td>35%</td>
                                        <td>91.3%</td>
                                        <td><span class="badge bg-success">4.9/5</span></td>
                                        <td><span class="trend-badge up">+22%</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="showDestinationDetails('Tokyo')">
                                                <i class="fas fa-chart-line"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Londres</strong></td>
                                        <td>165</td>
                                        <td class="text-success fw-bold">198,450‚Ç¨</td>
                                        <td>25%</td>
                                        <td>82.1%</td>
                                        <td><span class="badge bg-warning">4.5/5</span></td>
                                        <td><span class="trend-badge down">-5%</span></td>
                                        <td>
                                            <button class="btn btn-sm btn-primary" onclick="showDestinationDetails('Londres')">
                                                <i class="fas fa-chart-line"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- ========== MODALS ========== -->
    
    <!-- Modal Pr√©dictions IA -->
    <div class="modal fade" id="predictionModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-crystal-ball me-2"></i>Pr√©dictions IA - 3 Prochains Mois</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="prediction-card">
                                <div class="prediction-icon bg-success">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <h5>Semaine Prochaine</h5>
                                <div class="prediction-value">+15%</div>
                                <p>Augmentation pr√©vue des r√©servations</p>
                                <small class="text-muted">Confiance: 87%</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="prediction-card">
                                <div class="prediction-icon bg-info">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h5>Mois Prochain</h5>
                                <div class="prediction-value">+8%</div>
                                <p>Croissance du revenu attendue</p>
                                <small class="text-muted">Confiance: 82%</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="prediction-card">
                                <div class="prediction-icon bg-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h5>F√©vrier 2025</h5>
                                <div class="prediction-value">-8%</div>
                                <p>Baisse saisonni√®re pr√©vue</p>
                                <small class="text-muted">Confiance: 91%</small>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <h6 class="mb-3"><i class="fas fa-lightbulb me-2"></i>Facteurs Cl√©s Identifi√©s</h6>
                    <ul class="prediction-factors">
                        <li><i class="fas fa-check-circle text-success me-2"></i>Vacances scolaires favorables</li>
                        <li><i class="fas fa-check-circle text-success me-2"></i>Tendance positive sur vols long-courrier</li>
                        <li><i class="fas fa-exclamation-circle text-warning me-2"></i>Concurrence accrue sur destination Europe</li>
                        <li><i class="fas fa-exclamation-circle text-warning me-2"></i>Hausse pr√©vue prix carburant</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" onclick="exportPredictions()">
                        <i class="fas fa-download me-2"></i>Exporter Rapport
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Insights -->
    <div class="modal fade" id="insightsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title"><i class="fas fa-lightbulb me-2"></i>Insights Automatiques</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="insights-list">
                        <div class="insight-item hot">
                            <div class="insight-icon">üî•</div>
                            <div class="insight-content">
                                <h6>Forte Demande D√©tect√©e</h6>
                                <p>Les vols <strong>Paris ‚Üí New York</strong> ont +34% de demande ce mois. Consid√©rez d'augmenter la capacit√© ou les prix.</p>
                                <button class="btn btn-sm btn-primary" onclick="applyInsight('ny-demand')">
                                    <i class="fas fa-magic me-1"></i>Appliquer Recommandation
                                </button>
                            </div>
                        </div>
                        
                        <div class="insight-item warning">
                            <div class="insight-icon">‚ö†Ô∏è</div>
                            <div class="insight-content">
                                <h6>Alerte Annulations</h6>
                                <p>Taux d'annulation sur <strong>Duba√Ø</strong> en hausse de +12%. V√©rifiez la qualit√© de service et les conditions tarifaires.</p>
                                <button class="btn btn-sm btn-warning" onclick="investigateIssue('dubai-cancel')">
                                    <i class="fas fa-search me-1"></i>Investiguer
                                </button>
                            </div>
                        </div>
                        
                        <div class="insight-item success">
                            <div class="insight-icon">‚úÖ</div>
                            <div class="insight-content">
                                <h6>Performance Exceptionnelle</h6>
                                <p><strong>Tokyo</strong> affiche un taux de satisfaction de 4.9/5 et une croissance de +22%. Excellent positionnement.</p>
                            </div>
                        </div>
                        
                        <div class="insight-item info">
                            <div class="insight-icon">üí°</div>
                            <div class="insight-content">
                                <h6>Opportunit√© Marketing</h6>
                                <p>Les recherches pour <strong>Berlin</strong> augmentent de +45% mais les conversions restent faibles (18%). Opportunit√© de campagne cibl√©e.</p>
                                <button class="btn btn-sm btn-info" onclick="createCampaign('berlin')">
                                    <i class="fas fa-bullhorn me-1"></i>Cr√©er Campagne
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Recommandations -->
    <div class="modal fade" id="recommendationsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title"><i class="fas fa-magic me-2"></i>Recommandations Strat√©giques</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="recommendations-list">
                        <div class="recommendation-item priority-high">
                            <div class="recommendation-header">
                                <span class="priority-badge high">Priorit√© Haute</span>
                                <span class="impact-badge">Impact: +85,000‚Ç¨/mois</span>
                            </div>
                            <h6><i class="fas fa-arrow-up me-2"></i>Augmenter Prix Tokyo</h6>
                            <p>La demande pour Tokyo est tr√®s forte avec une satisfaction √©lev√©e. Recommandation: <strong>+5% sur tarifs Business et Premi√®re</strong></p>
                            <button class="btn btn-sm btn-success" onclick="applyRecommendation('tokyo-price')">
                                <i class="fas fa-check me-1"></i>Appliquer
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="simulateImpact('tokyo-price')">
                                <i class="fas fa-calculator me-1"></i>Simuler Impact
                            </button>
                        </div>
                        
                        <div class="recommendation-item priority-medium">
                            <div class="recommendation-header">
                                <span class="priority-badge medium">Priorit√© Moyenne</span>
                                <span class="impact-badge">Impact: +35,000‚Ç¨/mois</span>
                            </div>
                            <h6><i class="fas fa-percentage me-2"></i>Promotion Berlin</h6>
                            <p>Taux d'occupation faible sur Berlin (52%). Recommandation: <strong>-15% pendant 2 semaines</strong> pour stimuler la demande.</p>
                            <button class="btn btn-sm btn-warning" onclick="applyRecommendation('berlin-promo')">
                                <i class="fas fa-check me-1"></i>Appliquer
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="simulateImpact('berlin-promo')">
                                <i class="fas fa-calculator me-1"></i>Simuler Impact
                            </button>
                        </div>
                        
                        <div class="recommendation-item priority-low">
                            <div class="recommendation-header">
                                <span class="priority-badge low">Priorit√© Basse</span>
                                <span class="impact-badge">Impact: +12,000‚Ç¨/mois</span>
                            </div>
                            <h6><i class="fas fa-users me-2"></i>Programme Fid√©lit√©</h6>
                            <p>20% de vos clients g√©n√®rent 65% du revenu. Recommandation: Cr√©er un <strong>programme VIP</strong> pour les fid√©liser.</p>
                            <button class="btn btn-sm btn-info" onclick="applyRecommendation('loyalty-program')">
                                <i class="fas fa-check me-1"></i>En Savoir Plus
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-success" onclick="applyAllRecommendations()">
                        <i class="fas fa-check-double me-2"></i>Appliquer Toutes (Priorit√© Haute)
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal D√©tails KPI -->
    <div class="modal fade" id="kpiDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="kpiDetailsTitle">D√©tails KPI</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="kpiDetailsContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal D√©tails Destination -->
    <div class="modal fade" id="destinationDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-map-marker-alt me-2"></i>Analyse D√©taill√©e - <span id="destinationName"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <div class="stat-mini-card">
                                <h6>R√©servations</h6>
                                <div class="value">245</div>
                                <small class="text-success">+15% vs N-1</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-mini-card">
                                <h6>Revenu Moyen</h6>
                                <div class="value">1,872‚Ç¨</div>
                                <small class="text-success">+8% vs N-1</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-mini-card">
                                <h6>Taux Retour</h6>
                                <div class="value">38%</div>
                                <small class="text-info">Clients r√©currents</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-mini-card">
                                <h6>NPS Score</h6>
                                <div class="value">72</div>
                                <small class="text-success">Excellent</small>
                            </div>
                        </div>
                    </div>
                    
                    <h6 class="mb-3">√âvolution Mensuelle</h6>
                    <canvas id="destinationTrendChart" style="max-height: 300px;"></canvas>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary">
                        <i class="fas fa-download me-2"></i>Exporter Rapport
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ===== GRAPHIQUES =====
        
        // 1. Graphique Pr√©dictions
        const ctxPrediction = document.getElementById('predictionChart').getContext('2d');
        new Chart(ctxPrediction, {
            type: 'line',
            data: {
                labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Ao√ªt', 'Sep', 'Oct', 'Nov', 'D√©c', 
                         'Jan 25', 'F√©v 25', 'Mar 25', 'Avr 25', 'Mai 25', 'Juin 25', 'Juil 25', 'Ao√ªt 25', 'Sep 25', 'Oct 25', 'Nov 25', 'D√©c 25'],
                datasets: [
                    {
                        label: 'Donn√©es Historiques',
                        data: [185000, 198000, 225000, 212000, 245000, 268000, 285000, 275000, 292000, 310000, 298000, 285000, null, null, null, null, null, null, null, null, null, null, null, null],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Pr√©visions',
                        data: [null, null, null, null, null, null, null, null, null, null, null, 285000, 295000, 268000, 312000, 325000, 342000, 358000, 375000, 368000, 385000, 402000, 395000, 388000],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderDash: [5, 5],
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Marge d\'Erreur (¬±5%)',
                        data: [null, null, null, null, null, null, null, null, null, null, null, null, 280000, 254000, 296000, 309000, 325000, 340000, 356000, 350000, 366000, 382000, 375000, 369000],
                        borderColor: 'rgba(245, 158, 11, 0.3)',
                        backgroundColor: 'rgba(245, 158, 11, 0.05)',
                        borderDash: [2, 2],
                        tension: 0.4,
                        fill: '+1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + '‚Ç¨';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return (value / 1000) + 'K‚Ç¨';
                            }
                        }
                    }
                }
            }
        });
        
        // 2. Funnel de Conversion
        const ctxFunnel = document.getElementById('funnelChart').getContext('2d');
        new Chart(ctxFunnel, {
            type: 'bar',
            data: {
                labels: ['Visiteurs', 'Recherches', 'S√©lections', 'R√©servations', 'Paiements'],
                datasets: [{
                    label: 'Nombre',
                    data: [10000, 7500, 5200, 3800, 3547],
                    backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
                    borderRadius: 5
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const percentage = ((context.parsed.x / 10000) * 100).toFixed(1);
                                return context.parsed.x.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                },
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });
        
        // 3. Comparaison Multi-Ann√©es
        const ctxComparison = document.getElementById('comparisonChart').getContext('2d');
        new Chart(ctxComparison, {
            type: 'bar',
            data: {
                labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin'],
                datasets: [
                    {
                        label: '2025',
                        data: [295, 312, 325, 342, 358, 375],
                        backgroundColor: '#667eea'
                    },
                    {
                        label: '2024',
                        data: [245, 268, 292, 278, 315, 342],
                        backgroundColor: '#10b981'
                    },
                    {
                        label: '2023',
                        data: [198, 215, 235, 220, 255, 275],
                        backgroundColor: '#f59e0b'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true, position: 'top' } },
                scales: { y: { beginAtZero: true } }
            }
        });
        
        // 4. Distribution G√©ographique
        const ctxGeo = document.getElementById('geoChart').getContext('2d');
        new Chart(ctxGeo, {
            type: 'doughnut',
            data: {
                labels: ['France üá´üá∑', 'USA üá∫üá∏', 'Allemagne üá©üá™', 'UK üá¨üáß', 'Italie üáÆüáπ', 'Autres'],
                datasets: [{
                    data: [35, 22, 15, 12, 8, 8],
                    backgroundColor: ['#667eea', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#6b7280']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });
        
        // 5. Analyse Pareto
        const ctxPareto = document.getElementById('paretoChart').getContext('2d');
        new Chart(ctxPareto, {
            type: 'bar',
            data: {
                labels: ['Top 20%', 'Middle 30%', 'Bottom 50%'],
                datasets: [
                    {
                        label: 'Clients',
                        data: [20, 30, 50],
                        backgroundColor: '#3b82f6',
                        yAxisID: 'y'
                    },
                    {
                        label: 'Revenu (%)',
                        data: [65, 25, 10],
                        backgroundColor: '#10b981',
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true } },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'Clients (%)' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'Revenu (%)' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });
        
        // 6. Heatmap
        function generateHeatmap() {
            const days = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            const hours = ['00h', '04h', '08h', '12h', '16h', '20h'];
            const heatmapGrid = document.getElementById('heatmapGrid');
            
            let html = '<table class="heatmap-table"><thead><tr><th></th>';
            hours.forEach(hour => html += `<th>${hour}</th>`);
            html += '</tr></thead><tbody>';
            
            days.forEach(day => {
                html += `<tr><td class="heatmap-label">${day}</td>`;
                hours.forEach(() => {
                    const value = Math.floor(Math.random() * 100);
                    const color = value > 70 ? 'hot' : value > 40 ? 'warm' : 'cool';
                    html += `<td class="heatmap-cell ${color}" title="${value}%">${value}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            heatmapGrid.innerHTML = html;
        }
        
        generateHeatmap();
        
        // ===== FONCTIONS INTERACTIVES =====
        
        function updateStatistics() {
            showSuccessNotification('Statistiques mises √† jour !');
        }
        
        function openPredictionModal() {
            const modal = new bootstrap.Modal(document.getElementById('predictionModal'));
            modal.show();
        }
        
        function openInsightsModal() {
            const modal = new bootstrap.Modal(document.getElementById('insightsModal'));
            modal.show();
        }
        
        function openRecommendationsModal() {
            const modal = new bootstrap.Modal(document.getElementById('recommendationsModal'));
            modal.show();
        }
        
        function showKPIDetails(kpiType) {
            const titles = {
                revenue: 'Revenu Total',
                conversion: 'Taux de Conversion',
                avg: 'Valeur Moyenne',
                roi: 'ROI Marketing',
                satisfaction: 'Satisfaction Client',
                growth: 'Croissance Annuelle'
            };
            
            document.getElementById('kpiDetailsTitle').textContent = 'D√©tails - ' + titles[kpiType];
            document.getElementById('kpiDetailsContent').innerHTML = `
                <h6>√âvolution sur 12 mois</h6>
                <p>Analyse d√©taill√©e du KPI <strong>${titles[kpiType]}</strong></p>
                <canvas id="kpiDetailChart" style="max-height: 300px;"></canvas>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('kpiDetailsModal'));
            modal.show();
            
            setTimeout(() => {
                const ctx = document.getElementById('kpiDetailChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Ao√ªt', 'Sep', 'Oct', 'Nov', 'D√©c'],
                        datasets: [{
                            label: titles[kpiType],
                            data: Array.from({length: 12}, () => Math.floor(Math.random() * 100) + 50),
                            borderColor: '#667eea',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }, 300);
        }
        
        function showChartInfo(chartType) {
            const infos = {
                prediction: 'Ce graphique utilise un mod√®le de r√©gression lin√©aire avec moyenne mobile pour pr√©dire les revenus futurs bas√©s sur les donn√©es historiques.',
                funnel: 'L\'entonnoir de conversion montre le parcours client depuis la visite initiale jusqu\'au paiement final.',
                comparison: 'Comparaison des performances sur plusieurs ann√©es pour identifier les tendances saisonni√®res.',
                heatmap: 'Visualisation de la performance par jour et heure pour optimiser les campagnes marketing.',
                geo: 'Distribution g√©ographique des clients bas√©e sur leur pays d\'origine.',
                pareto: 'Principe de Pareto appliqu√©: 20% des clients g√©n√®rent 80% du revenu.'
            };
            
            showInfoNotification(infos[chartType]);
        }
        
        function showDestinationDetails(destination) {
            document.getElementById('destinationName').textContent = destination;
            const modal = new bootstrap.Modal(document.getElementById('destinationDetailsModal'));
            modal.show();
            
            setTimeout(() => {
                const ctx = document.getElementById('destinationTrendChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin'],
                        datasets: [{
                            label: 'R√©servations',
                            data: [32, 45, 52, 48, 58, 65],
                            borderColor: '#667eea',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }, 300);
        }
        
        function exportReport() {
            showSuccessNotification('Rapport complet export√© en PDF !');
        }
        
        function exportPredictions() {
            showSuccessNotification('Rapport de pr√©dictions export√© !');
        }
        
        function exportTable(tableName) {
            showSuccessNotification('Tableau "' + tableName + '" export√© en Excel !');
        }
        
        function applyInsight(insightId) {
            showSuccessNotification('Recommandation appliqu√©e avec succ√®s !');
        }
        
        function investigateIssue(issueId) {
            showInfoNotification('Ouverture du rapport d\'investigation...');
        }
        
        function createCampaign(destination) {
            showSuccessNotification('Campagne marketing cr√©√©e pour ' + destination + ' !');
        }
        
        function applyRecommendation(recId) {
            showSuccessNotification('Recommandation appliqu√©e ! Les changements prendront effet dans 24h.');
        }
        
        function simulateImpact(recId) {
            showInfoNotification('Simulation: Impact estim√© √† +45,000‚Ç¨ sur 3 mois avec une confiance de 85%.');
        }
        
        function applyAllRecommendations() {
            showSuccessNotification('Toutes les recommandations haute priorit√© ont √©t√© appliqu√©es !');
        }
        
        // Notifications
        function showSuccessNotification(message) {
            const toastHTML = `
                <div class="toast align-items-center text-white bg-success border-0" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-check-circle me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', toastHTML);
            const toastElement = document.body.lastElementChild;
            const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
            toast.show();
            
            setTimeout(() => toastElement.remove(), 3500);
        }
        
        function showInfoNotification(message) {
            const toastHTML = `
                <div class="toast align-items-center text-white bg-info border-0" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-info-circle me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', toastHTML);
            const toastElement = document.body.lastElementChild;
            const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
            toast.show();
            
            setTimeout(() => toastElement.remove(), 4500);
        }
        
        // Menu Toggle
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });
    </script>
    
    <style>
        /* Filtres Stats */
        .stats-filters {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        /* KPI Extended */
        .kpi-container-extended {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card.clickable {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .kpi-card.clickable:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .kpi-card.pink {
            background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
        }
        
        .kpi-card.teal {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        }
        
        /* Heatmap */
        .heatmap-container {
            padding: 20px;
            overflow-x: auto;
        }
        
        .heatmap-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .heatmap-table th,
        .heatmap-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .heatmap-label {
            font-weight: 600;
            background: #f9fafb;
        }
        
        .heatmap-cell {
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .heatmap-cell.hot {
            background: #ef4444;
            color: white;
        }
        
        .heatmap-cell.warm {
            background: #f59e0b;
            color: white;
        }
        
        .heatmap-cell.cool {
            background: #10b981;
            color: white;
        }
        
        /* Prediction Cards */
        .prediction-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            text-align: center;
        }
        
        .prediction-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 24px;
        }
        
        .prediction-value {
            font-size: 36px;
            font-weight: 700;
            color: #1f2937;
            margin: 10px 0;
        }
        
        .prediction-factors {
            list-style: none;
            padding: 0;
        }
        
        .prediction-factors li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* Insights */
        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .insight-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
        }
        
        .insight-item.hot {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        
        .insight-item.warning {
            background: #fee2e2;
            border-color: #ef4444;
        }
        
        .insight-item.success {
            background: #d1fae5;
            border-color: #10b981;
        }
        
        .insight-item.info {
            background: #dbeafe;
            border-color: #3b82f6;
        }
        
        .insight-icon {
            font-size: 36px;
        }
        
        .insight-content h6 {
            margin: 0 0 10px 0;
            font-weight: 700;
        }
        
        /* Recommendations */
        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .recommendation-item {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            background: white;
        }
        
        .recommendation-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .priority-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .priority-badge.high {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .priority-badge.medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .priority-badge.low {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .impact-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: #d1fae5;
            color: #065f46;
        }
        
        /* Analytics Table */
        .analytics-table-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .trend-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .trend-badge.up {
            background: #d1fae5;
            color: #065f46;
        }
        
        .trend-badge.down {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Stat Mini Cards */
        .stat-mini-card {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-mini-card h6 {
            font-size: 12px;
            color: #6b7280;
            margin: 0 0 8px 0;
        }
        
        .stat-mini-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
    </style>
</body>
</html>